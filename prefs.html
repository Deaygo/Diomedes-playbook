<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<head>
  <title>Diomedes - Preferences</title>
  <link rel="stylesheet" type="text/css" media="screen" href="css/view.css" />
  <link rel="stylesheet" type="text/css" media="screen" href="css/forms.css" />
</head>
<body class="prefWindow popUpWindow" onLoad="prefLoad( )">
  <h1>Preferences</h1>
  <form onsubmit="savePrefs( event );">
    <div class="formItem">
      <label for="nick">Nick: </label> <input type="text" id="nick" />
    </div>
    <div class="formItem">
      <label for="altNick">Alternate nick: </label> <input type="text" id="altNick" />
    </div>
    <div class="formItem">
      <label for="userName">Username: </label> <input type="text" id="userName" />
    </div>
    <div class="formItem">
      <label for="realName">Real name: </label> <input type="text" id="realName" />
    </div>
    <div class="formItem">
      <label for="finger">Finger (shows up for a CTCP finger): </label> <input type="text" id="finger" />
    </div>
    <div class="formItem">
      <label for="historyLength">History Length: </label> <input type="text" id="historyLength" />
    </div>
    <div class="formItem">
      <label for="theme">Theme: </label> <select id="theme" ><option value="none">none</option></select>
    </div>
    <div class="formItem">
      <label for="pollTime">Reconnect wait (seconds): </label> <input type="text" id="pollTime" />
    </div>
    <div class="formItem">
      <label for="font">Font: </label> <select id="font" ><option value="none">none</option></select>
    </div>
    <div class="formItem">
      <label for="fontSize">Base Font size (pixels - 8 min, 32 max ): </label> <input type="text" id="fontSize" />
    </div>
    <div class="formItem">
      <label for="updateDelay">Check for updates (in days, 0 turns off): </label> <input type="text" id="updateDelay" />
    </div>
    <div class="formItem">
      <label for="updateURL">Update URL: </label> <input type="text" id="updateURL" />
    </div>
    <div class="formItem">
    <div class="formItem">
      <label for="autoJoin">Auto join on invite: </label> <input type="checkbox" id="autoJoin" />
    </div>
    <div class="formItem">
      <label for="logging">Enable logging: </label> <input type="checkbox" id="logging" />
      <p class="formItemNote">Logs are in your documents directory</p>
    </div>
    <div class="formItem">
      <label for="time">Time: </label> <select id="time" ><option value="none">none</option></select>
    </div>
    <input type="submit" value="Save" />
    <button onclick="closePrefs( event );">Close</button>
  </form>
  <!--
  <script type="text/javascript" src="js/AIRIntrospector.js"></script>
  -->
  <script type="text/javascript">

    //var console =  air.Introspector.Console;

    var bridge = window.opener.prefBridge;
    var util = bridge.util;
		var dojo = bridge.dojo;
    var topics = bridge.topics;
    var prefs = bridge.preferences;

    function loadOptions( prefs ) {
      var options = [];
      for ( var i = 0; i < prefs.length; i++ ) {
        options.push( [
          "<option value='", i, "' ",
          ( "selected" in prefs[ i ] ? 'selected="selected" ' : '' ),
          ">",
          prefs[ i ].valueName,
          "</option>"
        ].join( "" ) );
      }
      return options.join( "\n" );
    }

    function setSelectedOption ( pref, select ) {
      for( var i = 0; i < pref.length; i++ ) {
        if ( "selected" in pref[ i ] ) {
          delete pref[ i ].selected;
        }
      }
      pref[ select.selectedIndex ][ "selected" ] = "true";
    }

    function savePrefs ( event ) {
      dojo.stopEvent( event );
      util.log( "Saving preferences." );
      //get prefs
      for ( pref in prefs ) {
        if ( pref == "multiOptionPrefs" ) {
          var p = prefs[ pref ];
          setSelectedOption( p.font, util.get( "font", document ) );
          setSelectedOption( p.time, util.get( "time", document ) );
          setSelectedOption( p.theme, util.get( "theme", document ) );
        } else if ( pref == "autoJoin" ) {
          var n = util.get( pref, document );
          prefs[ pref ] = n.checked.toString( );
        } else if ( pref == "logging" ) {
          var n = util.get( pref, document );
          prefs[ pref ] = n.checked.toString( );
        } else {
          var n = util.get( pref, document );
          if ( n ) {
            var value = n.value;
            if ( value || value === 0 || value === "" ) {
              prefs[ pref ] = value;
            }
          }
        }
      }
      dojo.publish( topics.PREFS_SAVE, [ prefs ] );
    }

    function closePrefs ( event ) {
      dojo.stopEvent( event );
      window.close( );
    }

  </script>
</body>
</html>



