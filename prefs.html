<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html> 
<head> 
  <title>Diomedes - Preferences</title> 
  <link rel="stylesheet" type="text/css" media="screen" href="css/view.css" />
  <link rel="stylesheet" type="text/css" media="screen" href="css/forms.css" />
</head> 
<body class="prefWindow popUpWindow" onLoad="prefLoad( )"> 
  <h1>Preferences</h1>
  <form onsubmit="savePrefs( event );">
    <div class="formItem">
      <label for="nick">Nick: </label> <input type="text" id="nick" />
    </div>
    <div class="formItem">
      <label for="altNick">Alternate nick: </label> <input type="text" id="altNick" />
    </div>
    <div class="formItem">
      <label for="userName">Username: </label> <input type="text" id="userName" />
    </div>
    <div class="formItem">
      <label for="realName">Real name: </label> <input type="text" id="realName" />
    </div>
    <div class="formItem">
      <label for="finger">Finger (shows up for a CTCP finger): </label> <input type="text" id="finger" />
    </div>
    <div class="formItem">
      <label for="historyLength">History Length: </label> <input type="text" id="historyLength" />
    </div>
    <div class="formItem">
      <label for="theme">Theme: </label> <input type="text" id="theme" />
    </div>
    <div class="formItem">
      <label for="pollTime">Reconnect wait (seconds): </label> <input type="text" id="pollTime" />
    </div>
    <div class="formItem">
      <label for="font">Font: </label> <select id="font" ><option value="none">none</option></select>
    </div>
    <div class="formItem">
      <label for="fontSize">Base Font size (pixels - 8 min, 32 max ): </label> <input type="text" id="fontSize" />
    </div>
    <input type="submit" value="Save" />
    <button onclick="closePrefs( event );">Close</button>
  </form>
  <script type="text/javascript">


    var bridge = window.opener.prefBridge;
    var util = bridge.util;
    var topics = bridge.topics;
    var prefs = bridge.preferences;

    function prefLoad ( ) {
      //load values to form
      for ( pref in prefs ) {
        if ( pref == "multiOptionPrefs" ) {
          var fonts = prefs[ pref ].font;
          var n = util.get( "font", document );
          var options = [];
          for ( var i = 0; i < fonts.length; i++ ) {
            options.push( [
              "<option value='", i, "' ",
              ( "selected" in fonts[ i ] ? 'selected="selected" ' : '' ),
              ">",
              fonts[ i ].valueName,
              "</option>"
            ].join( "" ) );
          }
          n.innerHTML = options.join( "\n" );
        } else {
          var n = util.get( pref, document );
          if ( n ) {
            n.value = prefs[ pref ];
          }
        }
      }
    }

    function savePrefs ( event ) {
      util.stopEvent( event );
      util.log( "Saving preferences." );
      //get prefs
      for ( pref in prefs ) {
        if ( pref == "multiOptionPrefs" ) {
          var n = util.get( "font", document );
          var fonts = prefs[ pref ].font;
          for( var i = 0; i < fonts.length; i++ ) {
            if ( "selected" in fonts[ i ] ) {
              delete fonts[ i ].selected;
            }
          }
          fonts[ n.selectedIndex ][ "selected" ] = "true";
        } else {
          var n = util.get( pref, document );
          if ( n ) {
            var value = n.value;
            if ( value || value === 0 || value === "" ) {
              prefs[ pref ] = value;
            }
          }
        }
      }
      util.publish( topics.PREFS_SAVE, [ prefs ] );
    }

    function closePrefs ( event ) {
      util.stopEvent( event );
      window.close( );
    }

  </script>
</body>
</html>



